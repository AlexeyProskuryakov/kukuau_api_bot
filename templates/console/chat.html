{{template "content_chat" .}}
{{define "content_chat" }}

<div class="container-fluid">
    <div class="row">
        <div id="left-bar" class="col-xs-1 col-md-2">

            {{$with := .with}}
            {{$all := "all"}}
            {{$all_tm := "all_hash_writers"}}
            <div id="contacts-wrapper" closed="true">
                <p>
                    <a class="bg-danger a-contact {{if eq_s $with $all}} c-active {{end}}"
                       href="/chat?with={{$all}}">
                        Написать всем
                    </a>
                </p>
                <br>
                {{range $contact := .contacts}}
                <p class="contact" id="{{$contact.ID}}">
                    <a id="a-{{$contact.ID}}" class="a-contact {{if eq_s $with $contact.ID}} c-active {{end}}"
                       href="/chat?with={{$contact.ID}}">
                        {{$contact.Name}}
                        <small id="s-{{$contact.ID}}">
                            {{if $contact.NewMessagesCount}}
                            ({{$contact.NewMessagesCount}})
                            {{end}}
                        </small>
                    </a>
                    <input class="name-change" type="text" name="{{$contact.ID}}" value="{{$contact.Name}}">
                </p>
                {{end}}
            </div>
        </div>

        <div id="chat-window" class="col-xs-11 col-md-10">
            <div class="row">
                <div class="message-wrap col-lg-8">
                    <div class="msg-wrap" id="chat-wrapper">
                        {{range $message := .messages}}
                        <div class="msg">
                            <h4 class="media-heading">{{$message.From}}
                                <small class="time">{{stamp_date $message.Time}}</small>
                            </h4>
                            <div class="col-lg-11">{{$message.Body}}</div>
                        </div>
                        <hr>
                        {{end}}
                        <div id="chat-end"></div>
                    </div>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="chat-input">
                    <form id="chat-form" method="post" action="/send_message">
                        <div class="form-group form-inline">
                            <label class="control-label"></label>
                    <textarea class="form-control form-inline" placeholder="..." name="chat-form-message"
                              id="chat-form-message"
                              rows="4" autofocus></textarea>

                            <button type="submit" class="btn btn-default btn-lg">
                                <span class="glyphicon glyphicon-send" aria-hidden="true"></span>
                            </button>
                        </div>
                        <div class="form-group">
                            <input type="hidden" name="from" id="from" value="me">
                            <input type="hidden" name="to" value="{{$with}}" id="with">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="chat_script.js"></script>

{{end}}
